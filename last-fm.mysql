drop database last_fm;
create database last_fm;
use last_fm;


create table users (
    id int not null primary key,
    age tinyint,
    gender enum('m', 'f')
);

create table artists (
    id int not null primary key auto_increment,
    artist_name varchar(1023) not null
);

create table tracks (
    id int not null primary key auto_increment,
    artist_id int,
    track_name varchar(1023) not null,
    foreign key (artist_id) references artists(id)
);

create table tags (
    id int not null primary key auto_increment,
    tag_name varchar(1023) not null
);

create table users_tracks (
    id int not null primary key auto_increment,
    user_id int not null,
    track_id int not null,
    added_when bigint not null,
    foreign key (user_id) references users(id),
    foreign key (track_id) references tracks(id)
);

create table artists_tags (
    id int not null primary key auto_increment,
    artist_id int not null,
    tag_id int not null,
    position tinyint not null,
    unique key (artist_id, tag_id),
    foreign key (artist_id) references artists(id),
    foreign key (tag_id) references tags(id)
);

create table tracks_tags (
    id int not null primary key auto_increment,
    track_id int not null,
    tag_id int not null,
    position tinyint not null,
    unique key (track_id, tag_id),
    foreign key (track_id) references tracks(id),
    foreign key (tag_id) references tags(id)
);


create index users_tracks__user_id on users_tracks(user_id);
create index artists_tags__artist_id on artists_tags(artist_id);
create index tracks_tags__track_id on tracks_tags(track_id);
